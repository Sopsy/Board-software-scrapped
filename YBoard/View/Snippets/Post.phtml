<?php include($viewFilesPath . '/Snippets/PostButtons.phtml') ?>

<div class="post-meta">
    <div class="user-info">
        <span class="username"><?= htmlspecialchars(\YBoard\Library\Text::formatUsername($post->username)) ?></span>
        <?php if ($post->userId == $thread->userId) : ?>
            <span class="text-tag op"><?= _('OP') ?></span>
        <?php endif ?>
    </div>
    <div class="post-info">
        <span class="post-time datetime"><?= $post->time ?></span>
        <?php if (!isset($tooltip)) : ?>
        <a href="/<?= $thread->boardUrl ?>/<?= $thread->id ?>#post-<?= $post->id ?>"
            onclick="<?php if (!$thread->locked || $user->isMod) : ?>replyToPost(<?= $post->id ?>);<?php endif ?>return false"
            class="post-id"><?= _('No.') ?> <?= $post->id ?></a>
        <?php else : ?>
        <a href="/scripts/posts/redirect/<?= $post->id ?>" class="post-id"><?= _('No.') ?> <?= $post->id ?></a>
        <?php endif ?>
    </div>
</div>

<blockquote class="message">
    <?php if (!empty($post->file)) : ?>
    <?php $fileUrl = $staticUrl . '/files/' . $post->file->folder . '/o/' . $post->file->name . '/' . rawurlencode($post->file->displayName) . '.' . $post->file->extension; ?>
    <figure class="post-file thumbnail" data-id="<?= $post->file->id ?>">
        <?php if (in_array($post->file->extension, ['m4a', 'mp4'])) : ?>
            <a href="<?= $fileUrl ?>" onclick="playMedia(this, event)">
                <?php if ($post->file->hasThumbnail) : ?>
                <img src="<?= $staticUrl ?>/files/<?= $post->file->folder ?>/t/<?= $post->file->name ?>.jpg"
                     width="<?= $post->file->thumbWidth ?>" height="<?= $post->file->thumbHeight ?>" alt="">
                <?php else : ?>
                <span class="no-thumbnail icon-music-note3"></span>
                <?php endif ?>
                <span class="overlay center icon-play4"></span>
                <?php if ($post->file->isGif) : ?>
                <span class="overlay bottom right">GIF</span>
                <?php else : ?>
                    <?php if ($post->file->hasSound) : ?>
                        <span class="overlay bottom right icon-volume-high"></span>
                    <?php else : ?>
                        <span class="overlay bottom right icon-mute"></span>
                    <?php endif ?>
                <?php endif ?>
            </a>
            <button class="button primary stop-media" onclick="stopAllMedia()"><?= _('Hide media') ?></button>
        <?php else : ?>
            <a href="<?= $fileUrl ?>" onclick="expandImage(this, event)">
                <img src="<?= $staticUrl ?>/files/<?= $post->file->folder ?>/t/<?= $post->file->name ?>.jpg"
                     width="<?= $post->file->thumbWidth ?>" height="<?= $post->file->thumbHeight ?>" alt="">
            </a>
        <?php endif ?>
        <figcaption>
            <a href="<?= $fileUrl ?>" target="_blank"><?= htmlspecialchars($post->file->displayName) ?></a>
            <span>
            <?php if (!empty($post->file->width)) : ?>
                <?= $post->file->width ?>&times;<?= $post->file->height ?>
            <?php endif ?>
            <?php if (!empty($post->file->duration)) : ?>
                <?= \YBoard\Library\Text::formatDuration($post->file->duration) ?>
            <?php endif ?>
                <?= \YBoard\Library\Text::formatBytes($post->file->size) ?>
                <?= htmlspecialchars(strtoupper($post->file->extension)) ?>
            </span>
        </figcaption>
    </figure>
    <?php endif ?>
    <?= \YBoard\Library\Text::formatMessage($post->message) ?>
</blockquote>

<?php if ($post->postReplies) : ?>
<div class="post-replies">
    <span><?= _('Replies') ?>:</span>
    <?php foreach ($post->postReplies as $postReply) : ?>
        <a href="/scripts/posts/redirect/<?= $postReply ?>" data-id="<?= $postReply ?>" class="reflink">&gt;&gt;<?= $postReply ?></a>
    <?php endforeach ?>
</div>
<?php endif ?>
